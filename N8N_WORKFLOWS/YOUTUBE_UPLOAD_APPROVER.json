{
  "name": "YouTube Upload Approver",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "youtube-approve",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "youtube-approve-webhook",
      "id": "webhook-trigger",
      "name": "Webhook Trigger"
    },
    {
      "parameters": {
        "filePath": "/tmp/pending_metadata.json"
      },
      "type": "n8n-nodes-base.readBinaryFile",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "read-metadata-file",
      "name": "Read Metadata File"
    },
    {
      "parameters": {
        "jsCode": "// Parse JSON from binary data with error handling\nconst input = $input.first();\nconst binaryData = input.binary.data?.data || input.binary.data;\n\nlet jsonText;\nif (Buffer.isBuffer(binaryData)) {\n  jsonText = binaryData.toString('utf-8');\n} else if (typeof binaryData === 'object') {\n  jsonText = JSON.stringify(binaryData);\n} else {\n  jsonText = String(binaryData);\n}\n\nconsole.log('DEBUG jsonText:', jsonText);\n\nlet metadata;\ntry {\n  metadata = JSON.parse(jsonText);\n} catch (e) {\n  throw new Error('JSON parse failed: ' + e.message + '. Content: ' + jsonText.substring(0, 200));\n}\n\nif (typeof metadata !== 'object' || metadata === null) {\n  throw new Error('Metadata is not an object! Type: ' + typeof metadata + ', Value: ' + JSON.stringify(metadata));\n}\n\nreturn [{\n  json: metadata\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300],
      "id": "parse-metadata",
      "name": "Parse Metadata JSON"
    },
    {
      "parameters": {
        "filePath": "/tmp/pending_video.mp4"
      },
      "type": "n8n-nodes-base.readBinaryFile",
      "typeVersion": 1,
      "position": [680, 300],
      "id": "read-video",
      "name": "Read Saved Video"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "video",
        "operation": "upload",
        "title": "={{$json.title}}",
        "categoryId": "22",
        "description": "={{$json.description}}",
        "privacyStatus": "public",
        "tags": "={{$json.keywords ? $json.keywords.join(',') : ''}}"
      },
      "type": "n8n-nodes-base.youTube",
      "typeVersion": 1,
      "position": [900, 300],
      "id": "upload",
      "name": "YouTube Upload"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json.message.chat.id}}",
        "text": "=‚úÖ Video YouTube'a upload edildi!\n\nüìå Ba≈ülƒ±k: {{$('Read Saved Metadata').first().json.title}}\n\nüé¨ Video ba≈üarƒ±yla yayƒ±nlandƒ±!"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1340, 200],
      "id": "telegram-success",
      "name": "Telegram: Upload Success",
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "command": "rm -f /tmp/pending_video.mp4 /tmp/pending_metadata.json /tmp/preview.mp4",
        "options": {}
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [1560, 200],
      "id": "cleanup",
      "name": "Cleanup Temp Files"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json.message.chat.id}}",
        "text": "‚ùå ƒ∞ptal edildi. Video silinecek."
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [680, 400],
      "id": "telegram-cancel",
      "name": "Telegram: Cancelled",
      "credentials": {
        "telegramApi": {
          "id": "TELEGRAM_CREDENTIAL_ID",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "command": "rm -f /tmp/pending_video.mp4 /tmp/pending_metadata.json /tmp/preview.mp4",
        "options": {}
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [900, 400],
      "id": "cleanup-cancel",
      "name": "Cleanup on Cancel"
    }
  ],
  "connections": {
    "Webhook Trigger": {"main": [[{"node": "Read Metadata File", "type": "main", "index": 0}]]},
    "Read Metadata File": {"main": [[{"node": "Parse Metadata JSON", "type": "main", "index": 0}]]},
    "Parse Metadata JSON": {"main": [[{"node": "Read Saved Video", "type": "main", "index": 0}]]},
    "Read Saved Video": {"main": [[{"node": "YouTube Upload", "type": "main", "index": 0}]]},
    "YouTube Upload": {"main": [[{"node": "Telegram: Upload Success", "type": "main", "index": 0}]]},
    "Telegram: Upload Success": {"main": [[{"node": "Cleanup Temp Files", "type": "main", "index": 0}]]}
  },
  "pinData": {},
  "settings": {"executionOrder": "v1"},
  "active": false
}
